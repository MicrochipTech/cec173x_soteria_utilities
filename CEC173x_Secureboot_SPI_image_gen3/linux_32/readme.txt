 MCHP - Auto SPI Image generator
===========================
THIS FOLDER CONTAINS FOLLOWING FILES:

1. Open the terminal with the super user
   sudo su
   Type the password of the system    
   Install the srec_cat using the below command
   sudo add-apt-repository ppa:pmiller-opensource/ppa
   sudo apt-get update
   sudo apt-get install srecord

2. Copy this executables/shell script  into where the spi_cfg.txt is available
  

3. Check the spi_cfg.txt is properly updated or not,
   Check the test key path/bin file is updated properly.
   Refer the data sheets and update the configuration properly
   
4. Run the script using the below command
   Use this command to remove the carraige return in the shell script
   sed -i -e 's/\r$//'   auto_spi_img_gen.sh
  ./auto_spi_img_gen.sh  <MPLABX IDE generated HEX file>
  
5. It call the srec_cat/secure_boot_spi_gen  in the background
6. Generate the spi image with the test keys provided in this DIR
7. Run the below command of 
   In the terminal
   chmod 777 * 
8. Copy that spi image into pendrive
9. Don't eject the pendrive
10.Terminal type the command as below, it will tell that the file is copying 
   into pendrive :
   sync
 
   

 
   

ecprivkey001.pem                : ECDSA private key with password ECDSA256 
									for authetication of CEC image under input_test_keys
ecpubkey002_crt.pem             : ECDH public key to encrypt the CECimage 
                                  under input_test_keys
secure_boot_spi_gen			    : SPI Image Generator  Executable file.
spi_cfg.txt						: SPI Image configuration file to configure the 
									APCFG ,APFW image table specified in the DOS
srec_cat 					: Executable to convert the hex file into bin file 
                                    to be used for spi image generator
auto_spi_img_gen.bat 			: Batch script to generate the spi image with the settings 
									made in the spi_cfg.txt where to provide the hex file 
									as input arguments and it call the spi image generator tools
									to get the spi image
private_key1/2.pem			    : RSA PKCS 2K private test key	under input_test_keys						
public_key1/2.pem					: RSA PKCS 2K public test key	under input_test_keys						
					

help.txt						: values to be provide on  spi_cfg.txt 									
readme.txt                  : This File

**************************************************************************
*           Binary and SPI Image Generation Usage Help                   *
**************************************************************************

Steps to generate the SPI image :
1) Copy the MPLABX IDE generated HEX files from "dist" DIR into these current
  DIR
2) open the  command prompt:
   Use below command as 
   auto_spi_img_gen.sh  < HEX file from the IDE generated > 
  The above batch script will use srec_cat which convert the HEX into bin_file.bin 
  in 60KB   and this binary will be provided into the spi_cfg.txt and it
  call the secure_boot_spi_gen.exe to get the spi image
  
   **********srec_cat Usage ************************************************************
   *srec_cat <hex file name> -intel -offset <offset value with polarity> -o <bin file name> - binary

   *hex file name               - hex file generated by the IDE
   *offset value with polarity  - in case of nullifying the offset, add minus
                              sign; in case of adding an offset, add plus 
                              sign. for usage with spi image generator, we need 
                              the offset to be removed, hence minus sign is to 
                              be added. 
	*bin file name               - name of the bin file required

  It uses the below command to get the bin_file.bin in 60KB 
  ABove batch script it uses the below command 
  a)srec_cat <MPLABX IDE GENERATED HEX FILE> -intel -offset -0xB0000 -o bin_file1.bin -binary
  b)srec_cat bin_file1.bin -binary --fill 0 -over bin_file1.bin -binary 0xE000 0xF000 -o bin_file.bin -binary
	
	*******SPI Image Generation *******************************************************
	*In spi_cfg.txt used by the secure_boot_spi_gen, add 'FwBinFile' - same as ****
    *the bin file generated as above and 'FwLoadAddress' same as the SRAM address  ****
    *used in the IDE for compilation.******
  a) It uses the below command to be run in command prompt to get the spi image
      secure_boot_spi_gen


  
 ~~~~~~~~~End of Document~~~~~~~~~